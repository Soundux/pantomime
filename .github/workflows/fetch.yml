on:
  workflow_dispatch:

name: Update Mime-DB
jobs:
  update-mime:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        language: ["cpp"]

    steps:
      - name: âœ… Checkout
        uses: actions/checkout@v2.4.0

      - name: ğŸ—ï¸ Install build dependencies
        run: "sudo apt-get update && sudo apt-get install git build-essential cmake"

      - name: ğŸ”¨ Compile
        run: "mkdir build && cd build && cmake .. -Dpantomime_fetcher=ON && cmake --build . --config Debug"

      - name: â™»ï¸ Download Mime-DB
        run: "wget https://raw.githubusercontent.com/jshttp/mime-db/master/db.json"

      - name: ğŸ“¥ Fetch Changes
        run: "./build/fetcher db.json src/db.hpp"

      - name: ğŸ¤– Run Clang-Format
        run: "clang-format -i src/db.hpp"

      - name: ğŸŒ Commit & Push changes
        uses: EndBug/add-and-commit@v9
        with:
          push: true
          add: "src/db.hpp"
